package GUI;

import java.awt.Color;
import java.awt.Container;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.util.Vector;

import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.Timer;

import Class.Figure;
import Class.Point;


public class Game extends JFrame implements KeyListener{
	MiniMap mmm = new MiniMap();
	int count = 0;
	Timer timer;
	int M = 15;
	int N = 20;
	int II = 100;
	int JJ = 100;
	String data[] = {"111111111111111111111111111111111111111111111111111111111111110000110000110100000010000011110110000110000101111010111011110111111111101101111010111011110000101000001100001110001111110111101011111101100000101111110100001010111101111111100011110101001000110001111111111011110101011010110111111110000011110111011011110111000000111111110000001011000100011110001111110111101011010111011111100011110100001011211111011111101011110111111011110000011111111011110000111000110111110000011011110110111110110000100111010011110010100000011110111111011011111010101111011100111000011011110010101000001101111111000011110110101111111101111111111011110110100000000001100000011011110010111111111111101111000011111010111000000011101111111111111010000011111010000000000011110011111000111110111111110111110111011110111100110000000111110000000110031111111101110111111111111111111111111111111111111111111111111111111111111111",
					"111111111111111111111111111111111111111111111111111111111111110000000000000000000000000011110101111111111111111111111011110100000000000000000000011011110111111111111110111111111011110111111111100000101110111011110100000000101111101110111011110101101110101111101110111011110101101110101131101110111011110101101110000000001110111011110101101111111111111010111011110111101000100000011010111011110110001010101011111010111011110110111110101000001010111011110110110000001111111010111011110110110111111011111010111011110110110111111011111010111011110110110110111000011010111011110110110110111111011010111011110110110110111111011010111011110000110110000100011010111011110111110111111111011010111011110111110111111111011010111011110110000000000000000010000011110110111111111111111111111011110110111111111111111111111011110002000000000000000000000011111111111111111111111111111111111111111111111111111111111111",
					"111111111111111111111111111111111111111111111111111111111111111000000001110001100010000011110001111101000111101111101011110100110001010100001000101011110110110101110101101110100011110100110100000101100010111011110101110111111101111110011011111101000110000001000111011011110001011110111101011111000011110111011010111100011000011011110101011010111111111111011111110100010010010000000000000111110101011010111011111111110111110101011010021311100101110111110101001010111111101101110111110101111010100000101101110111110100000010101110101100000111110110111110111110101111011111110110110000000110101111000011110010110111110110100001011011110110110100010110101101011011110110110101011110101101001011110100000101000000001111111011110110111101111111111000000011110110100001000010001111101111110111111101011111101111101111110000000000000000000000001111111111111111111111111111111111111111111111111111111111111111",
					"111111111111111111111111111111121310000111011100000000000111101011110000000111111111010111101000011111110111101001000111101111000001000000001011110111100001011111110110111011000111101111000000000110000001011111101111111111111111101011011111100001111110111100001011000011101111000000110001111001011011101111110110110101111111011011100000010110010100100001011011101111010111110111101111001011101100010000000100001011111011100001010111011101101000000011101111011111011101101111110111101101000001011101100000110111100001111101000001111110110111101111000101110111011000110111101111110101110111011011110111100000000100000111000000000111101110011111110001011111111111101111111111011111111000000111100000000011000000001111110011101111111000011111101000000011101110001011110000101011111011100000101010110110100000000011101111101010000010101110111011100000001000110110100010100011111111111111111111111111111111",
					"111111111111111111111111111111121310000111011100000000000111101011110000000111111111010111101000011111110111101001000111101111000001000000001011110111100001011111110110111011000111101111000000000110000001011111101111111111111111101011011111100001111110111100001011000011101111000000110001111001011011101111110110110101111111011011100000010110010100100001011011101111010111110111101111001011101100010000000100001011111011100001010111011101101000000011101111011111011101101111110111101101000001011101100000110111100001111101000001111110110111101111000101110111011000110111101111110101110111011011110111100000000100000111000000000111101110011111110001011111111111101111111111011111111000000111100000000011000000001111110011101111111000011111101000000011101110001011110000101011111011100000101010110110100000000011101111101010000010101110111011100000001000110110100010100011111111111111111111111111111111"};
	
	Color cl[] = {Color.GRAY, Color.black, Color.red, Color.green, Color.LIGHT_GRAY};
	Container cn;
	Figure F = new Figure(108, 114);
	JButton bt[][] = new JButton[M][N];
	int a[][] = new int[300][300];
	int A[][] = new int[30][30];
	public Game() {
		super("Tank Game - HaiZuka");
		ininMaxtrix();
		cn = init();
		timer.start();
	}
	
	public Container init() {
		Container cn = this.getContentPane();
		
		JPanel pn = new JPanel();
		pn.setLayout(new GridLayout(M, N));
		
		for (int i = 0; i < M; i++)
			for (int j = 0; j < N; j++) {
				bt[i][j] = new JButton();
				bt[i][j].addKeyListener(this);
				bt[i][j].setBorder(null);
				pn.add(bt[i][j]);
			}
		
		cn.add(pn);
		
		this.setVisible(true);
		this.setSize(900, 700);
//		this.setLocationRelativeTo(null);
		this.setLocation(390, 0);
		setResizable(false);
		update();
		setDefaultCloseOperation(EXIT_ON_CLOSE);
//		setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
		
		timer = new Timer(1000, new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				count++;
				if (count % 40 == 0) {
					mmm.setVisible(true);
					setVisible(true);
				} else if (count % 40 > 10 && 1 > 2) {
					mmm.setVisible(false);
				}
			}
		});
		
		return cn;
	}
	
	public void ininMaxtrix() {
		int k = (int) (Math.random() * (data.length - 1));
		String dt = data[k];
		int index = 0;
		
		for (int i = 0; i < 30; i++)
			for (int j = 0; j < 30; j++)
				A[i][j] = 1;
		
		for (int i = 0; i < 300; i += 10)
			for (int j = 0; j < 300; j += 10) {
				int value = dt.charAt(index++) - 48;
				if (value == 2) {
					II = i + 4;
					JJ = j + 5;
					F = new Figure(II, JJ);
					II -= 7;
					JJ -= 9;
				}
				for (int I = i; I < i + 10; I++)
					for (int J = j; J < j + 10; J++)
						a[I][J] = value;
				if (value == 0) {
					for (int I = i; I < i + 10; I++)
						for (int J = j; J < j + 10; J++)
							if (Math.random() < 0.05)
								a[I][J] = 4;
				}
				
			}
	}
	
	public void update() {
		for (int i = 0; i < M; i++)
			for (int j = 0; j < N; j++)
				bt[i][j].setBackground(cl[a[i + II][j + JJ]]);
		Vector vv = F.getVec();
		Point p = F.getTt();
		for (int i = -1; i <= 1; i++)
			for (int j = -1; j <= 1; j++) 
				if (A[p.getX() / 10 + i][p.getY() / 10 + j] != 5){
					A[p.getX() / 10 + i][p.getY() / 10 + j] = a[p.getX() + i * 10][p.getY() + j * 10];
					if (A[p.getX() / 10 + i][p.getY() / 10 + j] == 4)
						A[p.getX() / 10 + i][p.getY() / 10 + j] = 0;
				}
		if (A[p.getX() / 10 ][p.getY() / 10] == 0)
			A[p.getX() / 10 ][p.getY() / 10] = 5;
		
//		F.getTt().Display();
		for (int i = 0; i < vv.size(); i++) {
			p = (Point) vv.elementAt(i);
			bt[p.getX() - II][p.getY() - JJ].setBackground(Color.blue);
			if (a[p.getX()][p.getY()] == 3) {
				JOptionPane.showMessageDialog(null, "Win");
				System.exit(0);
			}
		}
		mmm.Update(A, F.getTt());
	}
	
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		new Game();
	}


	@Override
	public void keyTyped(KeyEvent e) {
		// TODO Auto-generated method stub
		
	}

	public boolean check(int X, int Y, int t) {
		if (t == 1) {
			if (a[X - 2][Y] == 1 || a[X - 1][Y - 1] == 1 || a[X - 1][Y + 1] == 1)
				return false;
		}
		if (t == 2) {
			if (a[X][Y + 2] == 1 || a[X - 1][Y + 1] == 1 || a[X + 1][Y + 1] == 1)
				return false;
		}
		if (t == 3) {
			if (a[X + 2][Y] == 1 || a[X + 1][Y - 1] == 1 || a[X + 1][Y + 1] == 1)
				return false;
		}
		if (t == 4) {
			if (a[X][Y - 2] == 1 || a[X - 1][Y - 1] == 1 || a[X + 1][Y - 1] == 1)
				return false;
		}
		
		return true;
	}
	
	@Override
	public void keyPressed(KeyEvent e) {
		// TODO Auto-generated method stub
		Point Ptemp = F.getTt();
		int X = Ptemp.getX();
		int Y = Ptemp.getY();
		if (e.getKeyCode() == e.VK_UP) {
			if (F.getDirection() != 1) {
				F = F.next(1);
			} else if (check(X, Y, 1)) {
				II --;
				F = F.next(1);
			}
			update();
		} else if (e.getKeyCode() == e.VK_DOWN) {
			if (F.getDirection() != 3) {
				F = F.next(3);
			} else if (check(X, Y, 3)) {
				II ++;
				F = F.next(3);
			}
			update();
		} else if (e.getKeyCode() == e.VK_LEFT) {
			if (F.getDirection() != 4) {
				F = F.next(4);
			} else if (check(X, Y, 4)) {
				JJ --;
				F = F.next(4);
			}
			update();
		} else if (e.getKeyCode() == e.VK_RIGHT) {
			if (F.getDirection() != 2) {
				F = F.next(2);
			} else if (check(X, Y, 2)) {
				JJ ++;
				F = F.next(2);
			}
			update();
		}
	}

	@Override
	public void keyReleased(KeyEvent e) {
		// TODO Auto-generated method stub
		
	}

}
